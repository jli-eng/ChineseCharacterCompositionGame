<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‰å­—æ‹†è§£æ¸¸æˆ</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        /* ä¿æŒåŸæœ‰æ ·å¼ï¼Œä»…ä¿®æ”¹char-boxç›¸å…³æ ·å¼ */
        body {
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            background-color: #FFF9E6;
            text-align: center;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* å…¶ä»–åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        h1 {
            color: #FF6B88;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        /* ä¿®æ”¹å­—ç¬¦æ¡†æ ·å¼ï¼Œä½¿å…¶æ›´çµæ´» */
        .char-box {
            min-width: 100px;
            min-height: 100px;
            width: clamp(100px, 15vw, 150px);
            height: clamp(100px, 15vw, 150px);
            border: 3px dashed #FFB6C1;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(30px, 8vw, 60px);
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .result-box {
            width: 150px;
            height: 150px;
            border: 3px solid #88C9FF;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: #5A8FCC;
        }
        
        /* è¾“å…¥åŒºåŸŸæ ·å¼ä¿æŒä¸å˜ */
        .input-container {
            margin: 20px 0;
        }
        
        #answer-input {
            font-size: 2em;
            padding: 10px 20px;
            width: 150px;
            text-align: center;
            border: 3px solid #FFD166;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #answer-input:focus {
            outline: none;
            border-color: #06D6A0;
        }
        
        .feedback {
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 1.5em;
        }
        
        .correct {
            color: #06D6A0;
        }
        
        .incorrect {
            color: #EF476F;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #reveal-btn {
            background-color: #FF9EB5;
            color: white;
        }
        
        #next-btn {
            background-color: #88C9FF;
            color: white;
        }
        
        #upload-btn {
            background-color: #A3D977;
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .cloud {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0.7;
            z-index: -1;
        }
        
        .hint {
            margin-top: 30px;
            color: #888;
            font-style: italic;
        }
        
        .decoration {
            position: fixed;
            font-size: 30px;
            z-index: -1;
            opacity: 0.2;
        }
        
        .upload-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #A3D977;
            border-radius: 15px;
            background-color: rgba(163, 217, 119, 0.1);
        }
        
        #file-input {
            display: none;
        }
        
        .upload-info {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .success-message {
            color: #4CAF50;
            margin-top: 10px;
            display: none;
        }

        .scoreboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 1.1em;
        }

        @media (max-width: 600px) {
            .scoreboard {
                position: static;
                margin-bottom: 20px;
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <h1>æ±‰å­—æ‹†è§£æ¸¸æˆ</h1>
    
    <div class="scoreboard">
        å¾—åˆ†: <span id="score">0</span>
    </div>
    
    <div class="upload-container">
        <button id="upload-btn">ä¸Šä¼ æ±‰å­—ç»„åˆExcel</button>
        <input type="file" id="file-input" accept=".xlsx, .xls" />
        <!-- æ›´æ–°ä¸Šä¼ è¯´æ˜ -->
        <p class="upload-info">Excelæ ¼å¼ï¼šå‰Nåˆ—-éƒ¨ä»¶ï¼ˆå¯å¤šä¸ªï¼‰ï¼Œæœ€åä¸€åˆ—-ç»„åˆç»“æœï¼ˆå¦‚ï¼šå£ å£ å£ å“ï¼‰</p>
        <p class="success-message" id="upload-success">æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼å·²æ›´æ–°æ±‰å­—ç»„åˆ</p>
    </div>
    
    <div class="game-container">
        <div id="characters-container" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
            <!-- å­—ç¬¦ä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div id="result-container" class="result-box">
            <!-- ç»“æœä¼šåœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="answer-input" maxlength="1" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" autocomplete="off">
        <p class="feedback" id="feedback"></p>
    </div>
    
    <div class="button-container">
        <button id="reveal-btn">æç¤ºç­”æ¡ˆ</button>
        <button id="next-btn">ä¸‹ä¸€ä¸ª</button>
    </div>
    
    <p class="hint">è¯•è¯•çœ‹è¿™äº›éƒ¨ä»¶èƒ½ç»„æˆä»€ä¹ˆæ±‰å­—ï¼Ÿåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ç­”æ¡ˆ</p>
    
    <div class="decoration" style="top: 10%; left: 5%;">ğŸ±</div>
    <div class="decoration" style="top: 20%; right: 10%;">ğŸ“š</div>
    <div class="decoration" style="bottom: 15%; left: 15%;">âœï¸</div>
    <div class="decoration" style="bottom: 25%; right: 5%;">ğŸ¨</div>
    
    <script>
        // æ›´æ–°ç¤ºä¾‹æ•°æ®ï¼ŒåŒ…å«å¤šéƒ¨ä»¶æ±‰å­—
        let characterCombinations = [
            { parts: ["æ—¥", "æœˆ"], result: "æ˜" },
            { parts: ["å¥³", "å­"], result: "å¥½" },
            { parts: ["äºº", "æœ¨"], result: "ä¼‘" },
            { parts: ["å£", "å£", "å£"], result: "å“" },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["æœ¨", "æœ¨", "æœ¨"], result: "æ£®" },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["ç«", "ç«", "ç«"], result: "ç„±" },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["çŸ³", "çŸ³", "çŸ³"], result: "ç£Š" },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["äºº", "äºº", "äºº"], result: "ä¼—" },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["æœ¨", "ç›®", "æœ¨"], result: "ç›¸ç›¸" }, // ç¤ºä¾‹ï¼šä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["ç«‹", "æ—¥", "å"], result: "ç« " },  // ä¸‰ä¸ªéƒ¨ä»¶
            { parts: ["ç¦¾", "ç¦¾", "ç¦¾", "ç«"], result: "ç‡Š" } // å››ä¸ªéƒ¨ä»¶
        ];
        
        let usedCombinations = [];
        let currentCombination = null;
        let score = 0;
        let isAnswered = false;
        
        // åˆå§‹åŒ–æ¸¸æˆï¼ˆä¿æŒä¸å˜ï¼Œå› ä¸ºä½¿ç”¨äº†åŠ¨æ€å¾ªç¯ï¼‰
        function initGame() {
            if (usedCombinations.length === characterCombinations.length) {
                usedCombinations = [];
                alert("æ‰€æœ‰ç»„åˆå·²ç»å±•ç¤ºä¸€éäº†ï¼Œç°åœ¨é‡æ–°å¼€å§‹ï¼");
            }
            
            let availableCombinations = characterCombinations.filter(
                combo => !usedCombinations.includes(combo.result)
            );
            
            currentCombination = availableCombinations[
                Math.floor(Math.random() * availableCombinations.length)
            ];
            
            usedCombinations.push(currentCombination.result);
            
            // æ˜¾ç¤ºå­—ç¬¦éƒ¨ä»¶ï¼ˆåŠ¨æ€å¤„ç†ä»»æ„æ•°é‡çš„éƒ¨ä»¶ï¼‰
            const container = document.getElementById("characters-container");
            container.innerHTML = "";
            
            currentCombination.parts.forEach(part => {
                const charBox = document.createElement("div");
                charBox.className = "char-box";
                charBox.textContent = part;
                container.appendChild(charBox);
            });
            
            // é‡ç½®ç•Œé¢çŠ¶æ€
            document.getElementById("result-container").textContent = "";
            document.getElementById("answer-input").value = "";
            document.getElementById("feedback").textContent = "";
            document.getElementById("feedback").className = "feedback";
            document.getElementById("answer-input").focus();
            isAnswered = false;
        }
        
        // æ˜¾ç¤ºç»“æœï¼ˆä¿æŒä¸å˜ï¼‰
        function showResult() {
            if (currentCombination && !isAnswered) {
                document.getElementById("result-container").textContent = 
                    currentCombination.result;
                document.getElementById("feedback").textContent = "æ­£ç¡®ç­”æ¡ˆæ˜¯: " + currentCombination.result;
                document.getElementById("feedback").className = "feedback";
            }
        }
        
        // æ£€æŸ¥ç­”æ¡ˆï¼ˆä¿æŒä¸å˜ï¼‰
        function checkAnswer() {
            if (isAnswered) return;
            
            const userInput = document.getElementById("answer-input").value.trim();
            const feedbackElement = document.getElementById("feedback");
            
            if (userInput === currentCombination.result) {
                feedbackElement.textContent = "æ­£ç¡®ï¼å¤ªæ£’äº†ï¼";
                feedbackElement.className = "feedback correct";
                document.getElementById("result-container").textContent = currentCombination.result;
                
                score += 10;
                document.getElementById("score").textContent = score;
                
                isAnswered = true;
                
                setTimeout(() => {
                    initGame();
                }, 2000);
            } else if (userInput) {
                feedbackElement.textContent = "å†è¯•è¯•ï¼";
                feedbackElement.className = "feedback incorrect";
            }
        }
        
        // å¤„ç†Excelæ–‡ä»¶ä¸Šä¼ ï¼ˆä¿®æ”¹ä¸ºæ”¯æŒå¤šéƒ¨ä»¶ï¼‰
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (fileExtension !== 'xlsx' && fileExtension !== 'xls') {
                alert('è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsæ ¼å¼ï¼‰');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        alert('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');
                        return;
                    }
                    
                    // ä¿®æ”¹è§£æé€»è¾‘ï¼šå‰Nåˆ—ä½œä¸ºéƒ¨ä»¶ï¼Œæœ€åä¸€åˆ—ä½œä¸ºç»“æœ
                    const newCombinations = [];
                    jsonData.forEach((row, index) => {
                        const columns = Object.values(row);
                        // è‡³å°‘éœ€è¦2åˆ—ï¼ˆ1ä¸ªéƒ¨ä»¶+1ä¸ªç»“æœï¼‰
                        if (columns.length >= 2) {
                            // æœ€åä¸€åˆ—æ˜¯ç»“æœï¼Œå‰é¢çš„éƒ½æ˜¯éƒ¨ä»¶
                            const result = String(columns[columns.length - 1]).trim();
                            const parts = columns.slice(0, columns.length - 1)
                                .map(part => String(part).trim())
                                .filter(part => part); // è¿‡æ»¤ç©ºå€¼
                            
                            if (parts.length > 0 && result) {
                                newCombinations.push({ parts, result });
                            } else {
                                console.warn(`ç¬¬${index+1}è¡Œæ•°æ®ä¸å®Œæ•´ï¼Œå·²è·³è¿‡`);
                            }
                        } else {
                            console.warn(`ç¬¬${index+1}è¡Œæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œå·²è·³è¿‡`);
                        }
                    });
                    
                    if (newCombinations.length > 0) {
                        characterCombinations = newCombinations;
                        usedCombinations = [];
                        score = 0;
                        document.getElementById("score").textContent = score;
                        initGame();
                        
                        const successMsg = document.getElementById('upload-success');
                        successMsg.style.display = 'block';
                        setTimeout(() => {
                            successMsg.style.display = 'none';
                        }, 3000);
                    } else {
                        alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ±‰å­—ç»„åˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ ¼å¼');
                    }
                } catch (error) {
                    console.error('è§£æExcelæ–‡ä»¶å‡ºé”™:', error);
                    alert('è§£ææ–‡ä»¶æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // äº‹ä»¶ç›‘å¬ï¼ˆä¿æŒä¸å˜ï¼‰
        document.getElementById("reveal-btn").addEventListener("click", showResult);
        document.getElementById("next-btn").addEventListener("click", initGame);
        document.getElementById("upload-btn").addEventListener("click", () => {
            document.getElementById("file-input").click();
        });
        document.getElementById("file-input").addEventListener("change", handleFileUpload);
        
        const answerInput = document.getElementById("answer-input");
        answerInput.addEventListener("input", checkAnswer);
        answerInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                checkAnswer();
            }
        });
        
        function createClouds() {
            const colors = ["#FFD6E0", "#D6F3FF", "#E0FFD6", "#FFF2D6"];
            for (let i = 0; i < 8; i++) {
                const cloud = document.createElement("div");
                cloud.className = "cloud";
                cloud.style.width = Math.random() * 100 + 50 + "px";
                cloud.style.height = Math.random() * 60 + 30 + "px";
                cloud.style.left = Math.random() * 100 + "%";
                cloud.style.top = Math.random() * 100 + "%";
                cloud.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(cloud);
            }
        }
        
        window.onload = function() {
            createClouds();
            initGame();
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汉字拆解游戏</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        /* 保持原有样式，仅修改char-box相关样式 */
        body {
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            background-color: #FFF9E6;
            text-align: center;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* 其他原有样式保持不变 */
        h1 {
            color: #FF6B88;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        /* 修改字符框样式，使其更灵活 */
        .char-box {
            min-width: 100px;
            min-height: 100px;
            width: clamp(100px, 15vw, 150px);
            height: clamp(100px, 15vw, 150px);
            border: 3px dashed #FFB6C1;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(30px, 8vw, 60px);
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .result-box {
            width: 150px;
            height: 150px;
            border: 3px solid #88C9FF;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: #5A8FCC;
        }
        
        /* 输入区域样式保持不变 */
        .input-container {
            margin: 20px 0;
        }
        
        #answer-input {
            font-size: 2em;
            padding: 10px 20px;
            width: 150px;
            text-align: center;
            border: 3px solid #FFD166;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #answer-input:focus {
            outline: none;
            border-color: #06D6A0;
        }
        
        .feedback {
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 1.5em;
        }
        
        .correct {
            color: #06D6A0;
        }
        
        .incorrect {
            color: #EF476F;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #reveal-btn {
            background-color: #FF9EB5;
            color: white;
        }
        
        #next-btn {
            background-color: #88C9FF;
            color: white;
        }
        
        #upload-btn {
            background-color: #A3D977;
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .cloud {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0.7;
            z-index: -1;
        }
        
        .hint {
            margin-top: 30px;
            color: #888;
            font-style: italic;
        }
        
        .decoration {
            position: fixed;
            font-size: 30px;
            z-index: -1;
            opacity: 0.2;
        }
        
        .upload-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #A3D977;
            border-radius: 15px;
            background-color: rgba(163, 217, 119, 0.1);
        }
        
        #file-input {
            display: none;
        }
        
        .upload-info {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        .success-message {
            color: #4CAF50;
            margin-top: 10px;
            display: none;
        }

        .scoreboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 1.1em;
        }

        @media (max-width: 600px) {
            .scoreboard {
                position: static;
                margin-bottom: 20px;
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <h1>汉字拆解游戏</h1>
    
    <div class="scoreboard">
        得分: <span id="score">0</span>
    </div>
    
    <div class="upload-container">
        <button id="upload-btn">上传汉字组合Excel</button>
        <input type="file" id="file-input" accept=".xlsx, .xls" />
        <!-- 更新上传说明 -->
        <p class="upload-info">Excel格式：前N列-部件（可多个），最后一列-组合结果（如：口 口 口 品）</p>
        <p class="success-message" id="upload-success">文件上传成功！已更新汉字组合</p>
    </div>
    
    <div class="game-container">
        <div id="characters-container" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
            <!-- 字符会在这里动态生成 -->
        </div>
        <div id="result-container" class="result-box">
            <!-- 结果会在这里显示 -->
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="answer-input" maxlength="1" placeholder="请输入答案" autocomplete="off">
        <p class="feedback" id="feedback"></p>
    </div>
    
    <div class="button-container">
        <button id="reveal-btn">提示答案</button>
        <button id="next-btn">下一个</button>
    </div>
    
    <p class="hint">试试看这些部件能组成什么汉字？在输入框中输入答案</p>
    
    <div class="decoration" style="top: 10%; left: 5%;">🐱</div>
    <div class="decoration" style="top: 20%; right: 10%;">📚</div>
    <div class="decoration" style="bottom: 15%; left: 15%;">✏️</div>
    <div class="decoration" style="bottom: 25%; right: 5%;">🎨</div>
    
    <script>
        // 更新示例数据，包含多部件汉字
        let characterCombinations = [
            { parts: ["日", "月"], result: "明" },
            { parts: ["女", "子"], result: "好" },
            { parts: ["人", "木"], result: "休" },
            { parts: ["口", "口", "口"], result: "品" },  // 三个部件
            { parts: ["木", "木", "木"], result: "森" },  // 三个部件
            { parts: ["火", "火", "火"], result: "焱" },  // 三个部件
            { parts: ["石", "石", "石"], result: "磊" },  // 三个部件
            { parts: ["人", "人", "人"], result: "众" },  // 三个部件
            { parts: ["木", "目", "木"], result: "相相" }, // 示例：三个部件
            { parts: ["立", "日", "十"], result: "章" },  // 三个部件
            { parts: ["禾", "禾", "禾", "火"], result: "燊" } // 四个部件
        ];
        
        let usedCombinations = [];
        let currentCombination = null;
        let score = 0;
        let isAnswered = false;
        
        // 初始化游戏（保持不变，因为使用了动态循环）
        function initGame() {
            if (usedCombinations.length === characterCombinations.length) {
                usedCombinations = [];
                alert("所有组合已经展示一遍了，现在重新开始！");
            }
            
            let availableCombinations = characterCombinations.filter(
                combo => !usedCombinations.includes(combo.result)
            );
            
            currentCombination = availableCombinations[
                Math.floor(Math.random() * availableCombinations.length)
            ];
            
            usedCombinations.push(currentCombination.result);
            
            // 显示字符部件（动态处理任意数量的部件）
            const container = document.getElementById("characters-container");
            container.innerHTML = "";
            
            currentCombination.parts.forEach(part => {
                const charBox = document.createElement("div");
                charBox.className = "char-box";
                charBox.textContent = part;
                container.appendChild(charBox);
            });
            
            // 重置界面状态
            document.getElementById("result-container").textContent = "";
            document.getElementById("answer-input").value = "";
            document.getElementById("feedback").textContent = "";
            document.getElementById("feedback").className = "feedback";
            document.getElementById("answer-input").focus();
            isAnswered = false;
        }
        
        // 显示结果（保持不变）
        function showResult() {
            if (currentCombination && !isAnswered) {
                document.getElementById("result-container").textContent = 
                    currentCombination.result;
                document.getElementById("feedback").textContent = "正确答案是: " + currentCombination.result;
                document.getElementById("feedback").className = "feedback";
            }
        }
        
        // 检查答案（保持不变）
        function checkAnswer() {
            if (isAnswered) return;
            
            const userInput = document.getElementById("answer-input").value.trim();
            const feedbackElement = document.getElementById("feedback");
            
            if (userInput === currentCombination.result) {
                feedbackElement.textContent = "正确！太棒了！";
                feedbackElement.className = "feedback correct";
                document.getElementById("result-container").textContent = currentCombination.result;
                
                score += 10;
                document.getElementById("score").textContent = score;
                
                isAnswered = true;
                
                setTimeout(() => {
                    initGame();
                }, 2000);
            } else if (userInput) {
                feedbackElement.textContent = "再试试！";
                feedbackElement.className = "feedback incorrect";
            }
        }
        
        // 处理Excel文件上传（修改为支持多部件）
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (fileExtension !== 'xlsx' && fileExtension !== 'xls') {
                alert('请上传Excel文件（.xlsx 或 .xls格式）');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        alert('Excel文件中没有数据');
                        return;
                    }
                    
                    // 修改解析逻辑：前N列作为部件，最后一列作为结果
                    const newCombinations = [];
                    jsonData.forEach((row, index) => {
                        const columns = Object.values(row);
                        // 至少需要2列（1个部件+1个结果）
                        if (columns.length >= 2) {
                            // 最后一列是结果，前面的都是部件
                            const result = String(columns[columns.length - 1]).trim();
                            const parts = columns.slice(0, columns.length - 1)
                                .map(part => String(part).trim())
                                .filter(part => part); // 过滤空值
                            
                            if (parts.length > 0 && result) {
                                newCombinations.push({ parts, result });
                            } else {
                                console.warn(`第${index+1}行数据不完整，已跳过`);
                            }
                        } else {
                            console.warn(`第${index+1}行数据格式不正确，已跳过`);
                        }
                    });
                    
                    if (newCombinations.length > 0) {
                        characterCombinations = newCombinations;
                        usedCombinations = [];
                        score = 0;
                        document.getElementById("score").textContent = score;
                        initGame();
                        
                        const successMsg = document.getElementById('upload-success');
                        successMsg.style.display = 'block';
                        setTimeout(() => {
                            successMsg.style.display = 'none';
                        }, 3000);
                    } else {
                        alert('未找到有效的汉字组合数据，请检查Excel格式');
                    }
                } catch (error) {
                    console.error('解析Excel文件出错:', error);
                    alert('解析文件时出错，请检查文件格式是否正确');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 事件监听（保持不变）
        document.getElementById("reveal-btn").addEventListener("click", showResult);
        document.getElementById("next-btn").addEventListener("click", initGame);
        document.getElementById("upload-btn").addEventListener("click", () => {
            document.getElementById("file-input").click();
        });
        document.getElementById("file-input").addEventListener("change", handleFileUpload);
        
        const answerInput = document.getElementById("answer-input");
        answerInput.addEventListener("input", checkAnswer);
        answerInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                checkAnswer();
            }
        });
        
        function createClouds() {
            const colors = ["#FFD6E0", "#D6F3FF", "#E0FFD6", "#FFF2D6"];
            for (let i = 0; i < 8; i++) {
                const cloud = document.createElement("div");
                cloud.className = "cloud";
                cloud.style.width = Math.random() * 100 + 50 + "px";
                cloud.style.height = Math.random() * 60 + 30 + "px";
                cloud.style.left = Math.random() * 100 + "%";
                cloud.style.top = Math.random() * 100 + "%";
                cloud.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(cloud);
            }
        }
        
        window.onload = function() {
            createClouds();
            initGame();
        };
    </script>
</body>
</html>
